# 后端功能支持说明

## 概述

本文档说明了FMR应用与后端服务器的功能对接情况。根据后端API文档分析，部分功能已实现联网支持，部分功能因后端未提供相关API而保持本地模式。

## 后端支持的功能 ✅

以下功能已实现联网支持，可以与后端服务器同步数据：

### 1. 首页模块
- **获取首页仪表盘数据** (`GET /home/dashboard`)
  - 个性化问候语
  - 快捷入口
  - 今日进度（服药进度、运动进度）
  - 最近动态

### 2. 家庭成员管理模块
- **添加家庭成员** (`POST /family/members`)
- **获取成员列表** (`GET /family/members`)
- **获取成员详情** (`GET /family/members/{id}`)
- **更新成员信息** (`PUT /family/members/{id}`)
- **删除成员** (`DELETE /family/members/{id}`)

## 后端不支持的功能 ❌

以下功能因后端未提供相关API，将继续使用本地数据存储：

### 1. 药品管理模块 (Medication)
- 添加药品
- 查看药品列表
- 更新药品信息
- 删除药品
- 用药提醒管理

**说明**: 后端API文档中未包含药品管理相关接口，该模块数据仅保存在本地SQLite数据库中。

### 2. 检查报告模块 (LabReport)
- 添加检查报告
- 查看报告列表
- 查看报告详情
- 删除报告

**说明**: 后端API文档中未包含检查报告管理相关接口，该模块数据仅保存在本地。

### 3. 生活方式/每日目标模块 (Lifestyle/DailyGoal)
- 设置每日目标
- 记录运动数据
- 查看历史记录

**说明**: 后端API文档中未包含生活方式管理相关接口，该模块数据仅保存在本地。

### 4. 病历记录模块 (MedicalRecord)
- 添加病历记录
- 查看病历列表
- 查看病历详情
- 删除病历

**说明**: 后端API文档中提到了病历记录表结构，但未提供相关API接口，该模块数据仅保存在本地。

### 5. 文档管理模块 (Document)
- 上传文档
- 查看文档
- 删除文档

**说明**: 后端未提供文档上传和管理相关接口。

## 离线模式说明

应用支持完整的离线模式：

1. **未连接服务器时**：
   - 所有功能正常可用
   - 数据保存在本地SQLite数据库
   - 界面会显示"离线模式"提示

2. **连接服务器后**：
   - 支持的功能会自动同步数据到服务器
   - 不支持的功能继续使用本地数据
   - 界面会显示同步状态

3. **网络恢复时**：
   - 自动检测网络状态变化
   - 自动尝试同步本地数据到服务器

## 数据同步策略

### 支持同步的模块（家庭成员）
- **读取**: 优先从本地读取，联网时从服务器同步最新数据
- **写入**: 先保存到本地，联网时同步到服务器
- **冲突处理**: 以服务器数据为准

### 不支持同步的模块
- 数据仅保存在本地SQLite数据库
- 不受网络状态影响
- 功能完全可用

## 技术实现

### 网络层架构
```
RetrofitClient (Retrofit + OkHttp)
    ↓
FmrApiService (API接口定义)
    ↓
RemoteDataSource (远程数据源)
    ↓
Repository (本地+远程数据管理)
    ↓
ViewModel (UI状态管理)
```

### 关键组件
- `NetworkManager`: 网络状态监控
- `RemoteDataSource`: 远程API调用封装
- `SyncResult`: 同步结果封装
- `NetworkStatusIndicator`: 网络状态UI组件

## 服务器配置

默认服务器地址配置在 `RetrofitClient.kt` 中：

```kotlin
// 模拟器访问本机服务器
const val EMULATOR_LOCALHOST = "http://10.0.2.2:8080/api/"

// 真机访问（需替换为实际IP）
const val DEVICE_LOCALHOST = "http://192.168.1.100:8080/api/"
```

## 后续扩展建议

如果后端需要支持更多功能，建议按以下优先级添加API：

1. **高优先级**
   - 病历记录管理API
   - 检查报告管理API

2. **中优先级**
   - 药品管理API
   - 用药提醒API

3. **低优先级**
   - 生活方式/每日目标API
   - 文档上传API

## 更新日期

2026年1月29日
